# Frontend (Vite build -> Nginx static)
FROM node:20-slim AS builder
WORKDIR /app/web

COPY web/package*.json ./
RUN npm ci

COPY web ./
RUN npm run build

# Serve with Nginx and proxy /api to backend service
FROM nginx:1.27-alpine
WORKDIR /usr/share/nginx/html

# Static assets
COPY --from=builder /app/web/dist ./

# Nginx config: static + /api reverse proxy to backend service name "server"
COPY ./nginx.frontend.conf /etc/nginx/conf.d/default.conf

EXPOSE 80